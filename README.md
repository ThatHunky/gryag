# gryag

Telegram –≥—Ä—É–ø–æ–≤–∏–π –±–æ—Ç –∑ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º: –∫–æ—Ä–æ—Ç–∫—ñ –¥–æ—Ç–µ–ø–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é, –∂–∏–≤–∏—Ç—å—Å—è Gemini Flash 2.5 —Ç–∞ –ø–∞–º'—è—Ç–∞—î –∫–æ–Ω—Ç–µ–∫—Å—Ç –±–µ—Å—ñ–¥–∏. –í–∏–≤—á–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –∑–∞–ø–∞–º'—è—Ç–æ–≤—É—î —Ñ–∞–∫—Ç–∏ –ø—Ä–æ –Ω–∏—Ö –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–∞—Ü—ñ—ó.

## –§—ñ—á—ñ

- **–°–∞–º–æ–Ω–∞–≤—á–∞–Ω–Ω—è –±–æ—Ç–∞** (Phase 5, NEW!): –ë–æ—Ç –≤–∏–≤—á–∞—î **—Å–µ–±–µ** - —è–∫—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –ø—Ä–∞—Ü—é—é—Ç—å, —è–∫—ñ –ø–æ–º–∏–ª–∫–∏ —Ä–æ–±–∏—Ç—å, —è–∫ –ø–æ–∫—Ä–∞—â–∏—Ç–∏—Å—è. Semantic dedup, temporal decay, Gemini-—ñ–Ω—Å–∞–π—Ç–∏
- **–ë–∞–≥–∞—Ç–æ—Ä—ñ–≤–Ω–µ–≤–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç** (Phase 3): 5-—à–∞—Ä–æ–≤–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (immediate, recent, relevant, background, episodic) –¥–ª—è —Ç–æ—á–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π —ñ–∑ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏
- **–ì—ñ–±—Ä–∏–¥–Ω–∏–π –ø–æ—à—É–∫**: –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—è FTS5, —Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ–≥–æ –ø–æ—à—É–∫—É —Ç–∞ –≤–∞–∂–ª–∏–≤–æ—Å—Ç—ñ –¥–ª—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
- **–ï–ø—ñ–∑–æ–¥–∏—á–Ω–∞ –ø–∞–º'—è—Ç—å**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è —Ä–æ–∑–º–æ–≤ —É –∑–º—ñ—Å—Ç–æ–≤–Ω—ñ –µ–ø—ñ–∑–æ–¥–∏ –∑ –æ–ø–∏—Å–∞–º–∏
- **–ü—Ä–æ—Ñ—ñ–ª—é–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–≤—á–∞—î —Ç–∞ –∑–∞–ø–∞–º'—è—Ç–æ–≤—É—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (–ª–æ–∫–∞—Ü—ñ—è, –≤–ø–æ–¥–æ–±–∞–Ω–Ω—è, –Ω–∞–≤–∏—á–∫–∏, –º–æ–≤–∏)
- **–ì—ñ–±—Ä–∏–¥–Ω–µ –≤–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è —Ñ–∞–∫—Ç—ñ–≤**: 95% –≤–∏–ø–∞–¥–∫—ñ–≤ –±–µ–∑ API ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î regex –ø–∞—Ç—Ç–µ—Ä–Ω–∏ —Ç–∞ –ª–æ–∫–∞–ª—å–Ω—É LLM (Phi-3-mini)
- **–ú—É–ª—å—Ç–∏–º–µ–¥—ñ–∞**: –ø—ñ–¥—Ç—Ä–∏–º—É—î –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–∞ –≥–æ–ª–æ—Å–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è ‚Äî –∫–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—Å—É—î —ó—Ö —É –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
- **–ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π —Ç—Ä–æ—Ç–ª—ñ–Ω–≥**: —Å–ø–æ–∫—ñ–π–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –æ—Ç—Ä–∏–º—É—é—Ç—å –±—ñ–ª—å—à–∏–π –ª—ñ–º—ñ—Ç, —Å–ø–∞–º–µ—Ä–∏ —Å—Ç–∏—Å–∫–∞—é—Ç—å—Å—è
- **–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ —Ç–∞ API**: –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä, –ø–æ–≥–æ–¥–∞, –∫—É—Ä—Å–∏ –≤–∞–ª—é—Ç, –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è
- –ì–æ—Å—Ç—Ä–∏–π —Å–∞—Ä–∫–∞–∑–º, —á–æ—Ä–Ω–∏–π –≥—É–º–æ—Ä, —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
- –ê–¥–º—ñ–Ω–∏ –∑ –±—ñ–ª–æ–≥–æ —Å–ø–∏—Å–∫—É –º–æ–∂—É—Ç—å –±–∞–Ω–∏—Ç–∏ –∞–±–æ —Ä–æ–∑–±–∞–Ω—é–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–ª—è –±–æ—Ç–∞
- –ê–¥–º—ñ–Ω–∏ –Ω–µ –ø—ñ–¥–ø–∞–¥–∞—é—Ç—å –ø—ñ–¥ –ª—ñ–º—ñ—Ç–∏ —á–∏ –±–∞–Ω–∏

üìö **–î–æ–∫–ª–∞–¥–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è**: [`docs/README.md`](docs/README.md)

## –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
cp .env.example .env
# –∑–∞–ø–æ–≤–Ω—ñ—Ç—å TELEGRAM_TOKEN —Ç–∞ GEMINI_API_KEY
python -m app.main
```

### –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ: –õ–æ–∫–∞–ª—å–Ω–∞ –º–æ–¥–µ–ª—å –¥–ª—è –≤–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è —Ñ–∞–∫—Ç—ñ–≤

–î–ª—è —Ä–æ–±–æ—Ç–∏ –±–µ–∑ Gemini API –¥–ª—è –ø—Ä–æ—Ñ—ñ–ª—é–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (95% –≤–∏–ø–∞–¥–∫—ñ–≤):

```bash
# –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –º–æ–¥–µ–ª—å Phi-3-mini (~2.2GB)
bash download_model.sh

# –∞–±–æ –≤—Ä—É—á–Ω—É:
# wget https://huggingface.co/microsoft/Phi-3-mini-4k-instruct-gguf/resolve/main/Phi-3-mini-4k-instruct-q4.gguf -O models/phi-3-mini-q4.gguf

# –î–æ–¥–∞—Ç–∏ —É .env:
FACT_EXTRACTION_METHOD=hybrid
LOCAL_MODEL_PATH=models/phi-3-mini-q4.gguf
LOCAL_MODEL_THREADS=4
```

**–ú–µ—Ç–æ–¥–∏ –≤–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è —Ñ–∞–∫—Ç—ñ–≤:**

- `rule_based` - –õ–∏—à–µ regex –ø–∞—Ç—Ç–µ—Ä–Ω–∏ (–º–∏—Ç—Ç—î–≤–æ, 70% –ø–æ–∫—Ä–∏—Ç—Ç—è, 0 –≤–∞—Ä—Ç—ñ—Å—Ç—å)
- `local_model` - –õ–æ–∫–∞–ª—å–Ω–∞ LLM (100-500–º—Å, 85% –ø–æ–∫—Ä–∏—Ç—Ç—è, –ø–æ—Ç—Ä—ñ–±–Ω–∞ –º–æ–¥–µ–ª—å)
- `hybrid` - Regex + –ª–æ–∫–∞–ª—å–Ω–∞ LLM + –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π Gemini fallback (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)
- `gemini` - –¢—ñ–ª—å–∫–∏ Gemini API (–∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–π —Ä–µ–∂–∏–º)

–î–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è: [HYBRID_EXTRACTION_COMPLETE.md](HYBRID_EXTRACTION_COMPLETE.md)

## –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

- –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –æ–ø–∏—Å–∞–Ω—ñ –≤ `.env.example` (–º–æ–¥–µ–ª—å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ, –º–æ–¥–µ–ª—å –µ–º–±–µ–¥–∏–Ω–≥—ñ–≤, —à–ª—è—Ö –¥–æ –ë–î, –ª—ñ–º—ñ—Ç —ñ—Å—Ç–æ—Ä—ñ—ó, —Å–ø–∏—Å–æ–∫ –∞–¥–º—ñ–Ω—ñ–≤, –≤–µ–±-–ø–æ—à—É–∫).
- –©–æ–± —É–≤—ñ–º–∫–Ω—É—Ç–∏ Google Search Grounding, –¥–æ–¥–∞–π—Ç–µ `ENABLE_SEARCH_GROUNDING=true` —É `.env`. –£ –±–µ–∑–æ–ø–ª–∞—Ç–Ω–æ–º—É (Free) —Ç–∞—Ä–∏—Ñ—ñ Gemini 2.5 Flash/Flash-Lite –¥—ñ—î –ª—ñ–º—ñ—Ç **500 –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ –¥–µ–Ω—å** –Ω–∞ –ø—Ä–æ—î–∫—Ç. –ü–æ—à—É–∫ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `google_search_retrieval` (legacy SDK) ‚Äî –º–æ–¥–µ–ª—å —Å–∞–º–∞ –≤–∏—Ä—ñ—à—É—î, –∫–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É.
- –ë–∞–∑–∞ `SQLite` –∑–±–µ—Ä—ñ–≥–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è; —Å—Ö–µ–º–∞ –ª–µ–∂–∏—Ç—å —É `db/schema.sql`.
- –£–≤—ñ–º–∫–Ω—ñ—Ç—å Redis (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) —á–µ—Ä–µ–∑ `USE_REDIS=true` —Ç–∞ –≤–∫–∞–∂—ñ—Ç—å `REDIS_URL` –¥–ª—è –∫–µ—à—É–≤–∞–Ω–Ω—è.

## –ü–æ–≤–µ–¥—ñ–Ω–∫–∞

- –ö–æ–Ω—Ç–µ–∫—Å—Ç: –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –¥–æ 50 –æ—Å—Ç–∞–Ω–Ω—ñ—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –¥–ª—è –∫–æ–∂–Ω–æ—ó –ø–∞—Ä–∏ `chat_id + thread`, –ø–ª—é—Å –≤–±—É–¥–æ–≤–∞–Ω–∏–π —Å–µ–º–∞–Ω—Ç–∏—á–Ω–∏–π –ø–æ—à—É–∫ –ø–æ —Å—Ç–∞—Ä–∏—Ö –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è—Ö.
- –¢—Ä–∏–≥–µ—Ä–∏: –±–æ—Ç —Ä–µ–∞–≥—É—î –Ω–∞ `@username`, —Ä–µ–ø–ª–∞–π –≤–ª–∞—Å–Ω–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∞–±–æ –∑–≥–∞–¥–∫—É ¬´–≥—Ä—è–≥/gryag¬ª –±–µ–∑ –º–æ–¥–µ—Ä–∞—Ü—ñ–π–Ω–∏—Ö —Ñ—ñ–ª—å—Ç—Ä—ñ–≤.
- –Ø–∫—â–æ —Ñ–∞–π–ª ‚Äî —Ñ–æ—Ç–æ/–¥–æ–∫—É–º–µ–Ω—Ç –∑ MIME `image/*` —á–∏ `audio/*`, –∞–±–æ voice ‚Äî –±–æ—Ç –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –π–æ–≥–æ —Ç–∞ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –≤ Gemini.
- –ü—Ä–∏ –ø–µ—Ä–µ–≤–∏—â–µ–Ω–Ω—ñ –ª—ñ–º—ñ—Ç—É: –º–∏—Ç—Ç—î–≤–∞ —Ä—ñ–∑–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å —ñ–≥–Ω–æ—Ä—É—î –ø–æ–¥–∞–ª—å—à—É –æ–±—Ä–æ–±–∫—É –ø—Ä–æ—Ç—è–≥–æ–º –≥–æ–¥–∏–Ω–∏.
- Retention: —ñ—Å—Ç–æ—Ä—ñ—è, –∫–≤–æ—Ç–∏ –π –±–∞–Ω–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –¥–æ 30 –¥–Ω—ñ–≤ (–Ω–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è).

## –ê–¥–º—ñ–Ω-–∫–æ–º–∞–Ω–¥–∏

- `ADMIN_USER_IDS` ‚Äî –∫–æ–º–æ—é —Ä–æ–∑–¥—ñ–ª–µ–Ω–∏–π —Å–ø–∏—Å–æ–∫ Telegram user_id, —è–∫—ñ –º–æ–∂—É—Ç—å –∫–µ—Ä—É–≤–∞—Ç–∏ –±–æ—Ç–æ–º.
- `/gryagban` ‚Äî –≤–∏–∫–æ–Ω–∞–π—Ç–µ –∫–æ–º–∞–Ω–¥—É —É –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞–±–æ –ø–µ—Ä–µ–¥–∞–π—Ç–µ user_id –ø—ñ—Å–ª—è –∫–æ–º–∞–Ω–¥–∏, —â–æ–± –∑–∞–±–∞–Ω–∏—Ç–∏.
- `/gryagunban` ‚Äî –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–æ –∑–Ω—ñ–º–∞—î –±–∞–Ω.
- `/gryagprofile` ‚Äî –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (—Å–≤—ñ–π –∞–±–æ —É –≤—ñ–¥–ø–æ–≤—ñ–¥—å).
- `/gryagfacts` ‚Äî —Å–ø–∏—Å–æ–∫ —Ñ–∞–∫—Ç—ñ–≤ –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
- `/gryagself` ‚Äî **NEW!** –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ self-learning –ø—Ä–æ—Ñ—ñ–ª—å –±–æ—Ç–∞ (–µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, –≤–∏–≤—á–µ–Ω—ñ —Ñ–∞–∫—Ç–∏).
- `/gryaginsights` ‚Äî **NEW!** –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ Gemini-—ñ–Ω—Å–∞–π—Ç–∏ –ø—Ä–æ —Ç–µ, —è–∫ –±–æ—Ç –º–æ–∂–µ –ø–æ–∫—Ä–∞—â–∏—Ç–∏—Å—è.

## –õ—ñ—Ü–µ–Ω–∑—ñ—è

MIT
